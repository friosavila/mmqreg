% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrartcl}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi


\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

\KOMAoption{captions}{tableheading}
\makeatletter
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[skins,breakable]{tcolorbox}}
\makeatother
\makeatletter
\@ifundefined{shadecolor}{\definecolor{shadecolor}{rgb}{.97, .97, .97}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Quantile Regressions via Method of Moments with multiple fixed effects},
  pdfauthor={Fernando Rios-Avila; Leonardo Siles; Gustavo Canavire-Bacarreza},
  pdfkeywords={Fixed effects, Linear heteroskedasticity, Location-scale
model, Quantile regression},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Quantile Regressions via Method of Moments with multiple fixed
effects}
\author{Fernando Rios-Avila \and Leonardo Siles \and Gustavo
Canavire-Bacarreza}
\date{2023-10-26}

\begin{document}
\maketitle
\begin{abstract}
This paper proposes a new method to estimate quantile regressions with
multiple fixed effects. The method expands on the strategy proposed by
Machado and Santos Silva (2019), allowing for multiple fixed effects,
and providing various alternatives for the estimation of Standard
errors. We provide Monte Carlo simulations to show the finite sample
properties of the proposed method in the presence of two sets of fixed
effects. Finally, we apply the proposed method to estimate
\textbf{something interesting}
\end{abstract}
\ifdefined\Shaded\renewenvironment{Shaded}{\begin{tcolorbox}[sharp corners, enhanced, boxrule=0pt, borderline west={3pt}{0pt}{shadecolor}, frame hidden, interior hidden, breakable]}{\end{tcolorbox}}\fi

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

Quantile regression (QR), introduced by Koenker and Bassett (1978), is
an estimation strategy used for modeling the relationships between
explanatory variables X and the conditional quantiles of the dependent
variable \(q_\tau (y|x)\). Using QR one can obtain richer
characterizations of the relationships between dependent and independent
variables, by accounting for otherwise unobserved heterogeneity.

A relatively recent development in the literature has focused on
extending quantile regressions analysis to include individual fixed
effects in the framework of panel data. However, as described in Neyman
and Scott (1948), and Lancaster (2000), when individual fixed effects
are included in quantile regression analysis it generates an incident
parameter problem. While many strategies have been proposed for
estimating this type of model (see Galvão and Kato, 2018 for a brief
review), neither has become standard because of their restrictive
assumptions in regards to the individual effects, the computational
complexity, and implementation.

More recently, Machado and Santos Silva (2019) (MSS hereafter) proposed
a methodology based on a conditional location-scale model similar to the
one described in He (1997) and Zhao (2000), for the estimation of
quantile regressions models for panel data via a method of moments. This
method allows individual fixed effects allowing to have heterogeneous
effects on the entire conditional distribution of the outcome, rather
constraining their effect to be a location shift only as in Canay
(2011), Koenker (2004), and Lancaster (2000).

In principle, under the assumption that data generating process behind
the data is based on a multiplicative heteroskedastic process that is
linear in parameters (Cameron and Trivedi (2005), Machado and Santos
Silva (2019), He (1997) and Zhao (2000) ), the effect of a variable
\(X\) on the \(q_th\) quantile can be derived as the combination of a
location effect, and scale effect moderated by the quantile of an
underlying i.i.d. error. For statistical inference, MSS derives the
asymptotic distribution of the estimator, suggesting the use of
bootstrap standard errors, as well.

While this methodology is not meant to substitute the use of standard
quantile regression analysis, given the assumptions required for the
identification of the model, it provides a simple and fast alternative
for the estimation of quantile regression models with individual fixed
effects.

In this framework, our paper expands on Machado and Santos Silva (2019),
following some of the suggestions by the authors regarding further
research. First, making use of the properties of GMM estimators, we
derive various alternatives for the estimation of standard errors based
on the empirical Influence functions of the estimators. Second, we
reconsider the application of Frisch--Waugh--Lovell (FWL) theorem
(Frisch and Waugh (1933) and Lovell (1963)) to extend the MSS estimator
to allow for the inclusion of multiple fixed effects, for example,
individual and year fixed effects.

The rest of the paper is restructured as follows. Section 2 presents the
basic setup of the location-Scale model described in He (1997) and Zhao
(2000), tying the relationship between the standard quantile regression
model, and the location and scale model. It also revisits MSS
methodology, proposing alternative estimators for the standard errors
based on the properties of GMM estimators and the empirical influence
functions. It also shows that FWL theorem can be used to control for
multiple fixed effects. Section 3 presents the results of a small
simulation study and Section 4 illustrates the application of the
proposed methods with two empirical examples. Seccion 5 concludes.

\hypertarget{methodology}{%
\section{Methodology}\label{methodology}}

\hypertarget{sec-betas}{%
\subsection{Quantile Regression: Location-Scale model}\label{sec-betas}}

Quantile regressions are used to identify relationships between the
explanatory variables \(x\) and the conditional quantiles of the
dependent variable \(Q(y|\tau,X)\). This relationship is commonly
assumed to follow a linear functional form:

\begin{equation}\protect\hypertarget{eq-eq1}{}{Q(Y|X,\tau) =X\beta(\tau)
}\label{eq-eq1}\end{equation}

This allows for nonlinearities in the effect of \(X\) on \(Y\) across
all values of \(\tau\). This formulation can also be related to a random
coefficient model, where all coefficients are assumed to be some
nonlinear function of \(\tau\), where \(\tau\) follows a random uniform
distribution.

An alternative formulation of quantile regressions is the location-scale
model. This approach assumes that the conditional quantile of \(Y\)
given \(X\) and \(\tau\) can be expressed as a combination of two
models: the location model, which describes the central tendency of the
conditional distribution, and the scale model, which describes
deviations from the central tendency:

\begin{equation}\protect\hypertarget{eq-eq2}{}{Q(Y|X,\tau) =X\beta+X\gamma(\tau)
}\label{eq-eq2}\end{equation}

Here, the location parameters \(\beta\) are typically identified using a
linear regression model (as in Machado and Santos Silva (2019)), or a
median regression (as in Melly (2005)), and the scale parameters
\(\gamma(\tau)\) can be estimated using standard approaches.

Both the standard quantile regression (Equation~\ref{eq-eq1}) and the
location-scale specification (Equation~\ref{eq-eq2}) can be estimated as
the solution to a weighted minimization problem:

\begin{equation}\protect\hypertarget{eq-eq3}{}{\hat{\beta}(\tau) = \underset{\beta}{\operatorname{argmin}}
\left( \sum_{i\in y_i\geq x_i'\beta} \tau (y_i - x_i'\beta) - \sum_{i\in y_i<x_i'\beta} (1-\tau)(y_i - x_i'\beta) \right)
}\label{eq-eq3}\end{equation}

One characteristic of this estimator is that the \(\beta(\tau)\)
coefficients are identified locally, and thus the estimated quantile
coefficients will exhibit considerable variation when analyzed across
\(\tau\). It is also implicit that if one requires an analysis of the
entire distribution, it would be necessary to estimate the model for
each quantile.\footnote{There are other estimators that provide smoother
  estimates for the quantile regression coefficients using a kernel
  local weighted approach (Kaplan and Sun 2017), as well as identifying
  the full set of quantile coefficients simultaneously assuming some
  parametric functional forms (Frumento and Bottai 2016).}

One insightful extension to the location-scale parameterizations
suggested by He (1997), Cameron and Trivedi (2005), and Machado and
Santos Silva (2019) is to assume that the data-generating process (DGP)
can be written as a linear model with a multiplicative heteroskedastic
process that is linear in parameters.\footnote{Machado and Santos Silva
  (2019) also discuss a model where heteroskedasticity can be an
  arbitrary nonlinear function \(\sigma(x_i'\gamma)\), but develop the
  estimator for the linear case, i.e., when \(\sigma()\) is the identity
  function.}

\begin{equation}\protect\hypertarget{eq-eq4}{}{y_i=x_i'\beta+\varepsilon_i \times x_i'\gamma(\tau)
}\label{eq-eq4}\end{equation}

Under the assumption that \(\varepsilon\) is an independent and
identically distributed (iid) unobserved random variable that is
independent of \(X\), the conditional quantile of \(Y\) given \(X\) and
\(\tau\) can be written as:

\begin{equation}\protect\hypertarget{eq-eq5}{}{Q(Y|X,\tau) =X\beta+X\gamma \times Q(\varepsilon|\tau)
}\label{eq-eq5}\end{equation}

In this setup, the traditional quantile coefficients are identified as
the location model coefficients, plus the scale model coefficients
moderated by the \(\tau_th\) unconditional quantile of the standardized
error \(\varepsilon\).

\begin{equation}\protect\hypertarget{eq-eq6}{}{\beta(\tau) = \beta + \gamma \times Q(\varepsilon|\tau)
}\label{eq-eq6}\end{equation}

While this specification imposes a strong assumption on the DGP, it has
two advantages over the standard quantile regression model. First,
because the location and scale model can be identified globally, with
only a single parmater (\(Q(\varepsilon|\tau)\)) requiring local
estimation, this estimation approach would be more efficient than the
standard quantile regression model (Zhao (2000)). Second, under the
assumption that \(X\gamma\) is strictly possitive, the model would
produce quantile coefficients that do not cross.

Following MSS, the quantile regression model defined by
Equation~\ref{eq-eq5} can be estimated using a method of moments
approach. And while its possible to identify all coefficients
(\(\beta,\gamma, Q(\varepsilon|\tau)\)) simultaneously, we describe and
use the implementation approach advocated by MSS which identifies each
set of coefficients separately.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  The location model can be estimated using a standard linear regression
  model, where the dependent variable is the outcome \(Y\), and the
  independent variables are the explanatory variables \(X\) (including a
  constant) with an error \(u\), which is by definition heteroskedastic.
  In this case, the location model coefficients are identified under the
  following condition:
  \begin{equation}\protect\hypertarget{eq-eq7}{}{\begin{aligned}
    y_i &=x_i'\beta+u_i \\
    E[u 'X ] &=0
    \end{aligned}
  }\label{eq-eq7}\end{equation}
\item
  After the location model is estimated, the scale coefficients can be
  identified by modeling heteroskedasticity as a linear function of
  characteristics \(X\). For this we use the absolute value of the
  errors from the location model \(u\) as dependent variable, which
  would allow us to estimate the conditional standard deviation (rather
  than conditional variance) of the errors. In this case, the
  coefficients are identified under the following condition:
\end{enumerate}

\begin{equation}\protect\hypertarget{eq-eq8}{}{\begin{aligned}
  |u_i| &=x_i'\gamma+v_i \\
  E[ (|u|-X \gamma) X ] &=0
  \end{aligned}
}\label{eq-eq8}\end{equation}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Finally, given the location and scale coefficients, the \(\tau_{th}\)
  quantile of the error \(e\) can be estimated using the following
  condition:
\end{enumerate}

\begin{equation}\protect\hypertarget{eq-eq9}{}{\begin{aligned}
  E\left[  \mathbb{1}\left(x_i' (\beta + \gamma Q(\varepsilon|\tau)) \geq y_i \right) - \tau \right] &=0  \\
  E\left[  \mathbb{1}\left(   Q(\varepsilon|\tau)\geq \frac{y_i-x_i'\beta}{x_i'\gamma} \right) - \tau \right] &=0  \\
  \end{aligned}
}\label{eq-eq9}\end{equation}

Where one identifies the quantile of the error \(\varepsilon\) using
standardized errors \(\frac{y_i-x_i'\beta}{x_i'\gamma}\), or by finding
the values that identify the overall quantile coefficients
\(\beta(\tau)=\beta + \gamma Q(\varepsilon|\tau)\). Afterwords, the
conditional quantile coefficients is simply defined as the combination
of the location and scale coefficients.

\hypertarget{sec-se}{%
\subsection{Standard Errors: GLS, Robust, Clustered}\label{sec-se}}

As discussed in the previous section, the estimation of quantile
regression coefficients using the location-scale model with
heteroskedstic linear errors can be estimated using a the following set
of moments, which fits in the Generalized Method of Moments framework:

\begin{equation}\protect\hypertarget{eq-eq10}{}{\begin{aligned}
  E[u_i x_i ] &= E[h_{1,i}]=0 \\
  E[ (|u_i|-x_i \gamma) x_i ] &=E[h_{2,i}]=0 \\
  E\left[  \mathbb{1}\left(   Q(\varepsilon|\tau)\geq \frac{y_i-x_i'\beta}{x_i'\gamma} \right) - \tau \right] 
  &=E[h_{3,i}]=0 
  \end{aligned}
}\label{eq-eq10}\end{equation}

Under the conditions described in Newey and McFadden (1994) (see section
7), Cameron and Trivedi (2005) (see chapter 6.3.9) or as shown in
Machado and Santos Silva (2019), the location, scale and residual
quantile coefficients are asymptotically normal.\footnote{Zhao (2000)
  also shows that the quantile coefficients for the location-scale model
  also follows a normal distribution, but uses the assumption that the
  location model is derived using a least absolute deviation approach
  (median regression).}

Call \(\theta=[ \beta' \ \ \gamma' \ \ Q(\varepsilon|\tau)' ]'\) the set
of coefficients that are identified in Equation~\ref{eq-eq10}, a just
identified model. And the function \(h_i\) is a vector function that
stacks all the moments at the individual level described in
Equation~\ref{eq-eq10}. Then \(\hat\theta\) follows a normal
distribution with mean \(\theta\) and variance-covariance matrix
\(V(\theta)\) that is estimated as: \[
\hat{V}(\hat\theta)=\frac{1}{N} 
\bar G(\hat\theta)^{-1} 
\left( \frac{1}{N} \sum_{i=1}^N h_i h_i'  \Big|_{\theta=\hat\theta} \right) 
\bar G(\hat\theta)^{-1} 
\]

where the inner product is the moment covariance matrix, and
\(\bar{G}(\theta)\) is the Jacobian matrix of the moment equations
(Equation~\ref{eq-eq10}) evaluated at \(\hat\theta\).

\[\bar{G}(\theta) =-\frac{1}{N} \sum_{i=1} \frac{\partial h_i}{\partial \theta'} \Big|_{\theta=\hat\theta}\]

This is equivalent to the Eicker-White Heteroskedastic-Consistent
estimator for least-squares estimators.

In this framework, the quantile regression coefficients, a combination
of the location-scale-quantile estimates, will follow a normal
distribution with mean \(\beta(\tau) = \beta+Q(\varepsilon,\tau)\gamma\)
and variance-covariance matrix equal to:

\[\hat{V}(\beta(\tau)) = \Xi \hat{V}(\hat\theta) \Xi'
\]

where \(\Xi\) is a \(k \times (2k+1)\) matrix defined as:

\[\Xi = [ I(k), \hat Q(\varepsilon|\tau) \cdot I(k), \hat \gamma ]
\]

with \(I(k)\) being an identity matrix of dimension \(k\) (number of
explanatory variables in \(X\) including the constant).

The different types of Standard errors estimation, thus, depend on the
assumptions imposed for the estimation of \(V(\theta)\).

\hypertarget{multiple-fixed-effects-expanding-on-mss2019}{%
\subsection{Multiple Fixed Effects: Expanding on Machado and Santos
Silva (2019)}\label{multiple-fixed-effects-expanding-on-mss2019}}

Using the setup describe in the previous section, Machado and Santos
Silva (2019) proposes an extension to the model proposed by He (1997)
that would allow for the estimation of quantile regression models with
panel data, allowing for the inclussion of individual fixed effects.
However, as the authors suggest, the methodology can be generalized to
allow for the inclusion of multiple fixed effects. This type of analysis
may be useful when considering data such as employer-employee linked
data (Abowd, Kramarz, and Roux 2006), or teacher-student linked data
(Harris and Sass 2011). Or, in the most common case, allowing to control
for both individual and time fixed effects.

Reconsider the original model, and assume there are sets of unobserved
heterogeneity that are assumed to be constant across observations, if
they belong to common groups. In panel data, the groups would be the
individual fixed effects and the time fixed effects. Without loss of
generality, we can assume that the data generating process is as
follows:

\[\begin{aligned}
  y_{i} &= x_{i}' \beta + \delta_{g1} + \delta_{g2} + \nu_i \\
  \nu_i &= \varepsilon_i \times (x_{i}' \gamma + \zeta_{g1} + \zeta_{g2})   
  \end{aligned}
\]

where we assume \(x_{i}\) vary across groups \(g_1\) and \(g_2\), thus
are not collinear, and that \(\delta's\) and \(\zeta's\) are the
location and scale effects associated with groups fixed
effects.\footnote{We could just as well consider multiple sets of fixed
  effects}

If the dimension of groups \(g_k\) is low, this model could be estimated
using a dummy inclussion approach following Section~\ref{sec-betas}, and
standard errors obtained as discussed in Section~\ref{sec-se}. However,
if the dimensionsionality of \(g_k\) is high, dummy inclussion approach
may not be feasible. Instead, a more feasible approach is to apply the
Frisch-Waugh-Lovell (FWL) theorem, and partial out the impact of the
group fixed effects on the control variables \(x_{i}\), the outcome of
interest \(y_{i}\), with a similar approach for the identification of
\(\sigma(x)\). In the case of unbalanced setups, with multiple groups,
the estimation involves iterative processes for which various approaches
have been sugested and implemented (see Correia (2016), Gaure (2013),
Rios-Avila (2015), among others).

When applying the partialing out approach, some modifications to the
approach described in Section~\ref{sec-betas} is needed.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  For all dependent and independent variables in the model (\(w=y,x\)),
  we partial out the group fixed effects, and obtain the
  centered-residualized variables:
\end{enumerate}

\[\begin{aligned}
w_{i} &= \delta_{g1}^w + \delta_{g2}^w + u_{i}^w \\
w_{i}^{rc} &= E(w_{i}) + \hat{u}_{i}^w
\end{aligned}
\]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  We estimate the location model using the centered-residualized
  variables:
\end{enumerate}

\[y_{i}^{rc} = x_{i}^{rc'} \beta + nu_{i}
\]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Since \(|\hat \nu_i|\) is the dependent variable for the scale model,
  we apply the partialling out and recentering to this expression
  (\(|\hat \nu_i|^{rc}\)), and use that to estimate the model:
\end{enumerate}

\[|\hat\nu_{i}|^{rc} = x_{i}^{rc'} \gamma + e_{i}\]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Finally the standardized residuals \(\varepsilon_i\) can be obtained
  as follows
\end{enumerate}

\[\hat{\varepsilon}_{i} = \frac{\nu_{i}}{|\hat\nu_{i}|- \hat e_{i}}\]

where \(|\hat\nu_{i}|- \hat e_{i}\) is the prediction for the
conditional standard deviation
\(\sigma(x_i)=x_{i}' \gamma + \zeta_{g1} + \zeta_{g2}\)

The \(\tau_{th}\) quantile of the error \(\varepsilon\) can be estimated
as usual, and the variance-covariance matrices obtained in the same way
as before (see Section~\ref{sec-se}), but using \(x_{i}^{rc}\) instead
of \(x_{i}\) when estimating the influence functions for all estimated
coefficients.

\hypertarget{monte-carlo-simulations}{%
\section{Monte Carlo Simulations}\label{monte-carlo-simulations}}

\hypertarget{application-something-interesting}{%
\section{\texorpdfstring{Application: \textbf{Something
interesting}}{Application: Something interesting}}\label{application-something-interesting}}

\hypertarget{conclusions}{%
\section{Conclusions}\label{conclusions}}

\hypertarget{appendix}{%
\section{Appendix}\label{appendix}}

The estimation of quantile regression via moments assumes that the DGP
is linear in parameters, with an heteroskedastic error term that is also
linear function of parameters:

\[y = x\beta + e_i \times x\gamma\]

where \(e_i\) is an unobserved i.i.d. random variable that is
independent of \(x\), and such that \(x\gamma\) is larger than zero for
any \(x\).

In this case, the \(\tau_{th}\)conditional quantile model can be written
as:

\[q(y|\tau,X) = x(\beta + q(e|\tau) \times \gamma)\]

This model is identified under the following conditions:

\[\begin{aligned}
  E[(y_i-x_i'\beta)x_i ]  &= E[h_{1,i}]=0 \\
  E[ (|y_i-x_i'\beta|-x_i' \gamma) x_i ] &=E[h_{2,i}]=0 \\
  E\left[  \mathbb{1}\left( q(\varepsilon|\tau) x_i'\gamma +x_i'\beta\geq  y_i  \right) - \tau \right] 
   &=E[h_{3,i}]=0 
\end{aligned}
\]

In this model, to estimate the variance-covariance matrix the set of
coefficients \(\theta'=[\beta' \ \gamma' \ q(\varepsilon|\tau)']\), we
need to obtain the influence functions of all coefficients, which are
defined as:

\[\lambda_i = \bar G(\theta)^{-1}
\begin{bmatrix}
h_{1,i} \\
h_{2,i} \\
h_{3,i}
\end{bmatrix}
\]

where the Jacobian matrix \(\bar G(\theta)\) is defined as:

\[\bar G(\theta) = \begin{bmatrix}
\bar G_{11} & G_{12} & G_{13} \\
\bar G_{21} & \bar G_{22} & G_{23} \\
\bar G_{31} & \bar G_{32} & \bar G_{13} \\
\end{bmatrix}
\]

with

\[\bar G_{j,k} = - \frac 1 N \sum_{i=1}^N \frac{\partial h_{j,i}}{\partial \theta_k'} \ \forall j,k \in 1,2,3
\]

\hypertarget{first-moment-condition-location-model}{%
\subsubsection{First Moment Condition: Location
Model}\label{first-moment-condition-location-model}}

\[h_{1,i}=x_i(y_i-x_i'\beta)\]

\[\begin{aligned}
\bar G_{1,1} &=- \frac{1}{N} \sum_{i=1}^N \frac{\partial h_{j,i}}{\partial \beta'} \\
             &=- \frac{1}{N} \sum_{i=1}^N (-x_i x_i') \\
             &= N^{-1} X'X
\end{aligned}
\]

\[\begin{aligned}
\bar G_{1,2} = \bar G_{1,3} = 0
\]

\hypertarget{second-moment-condition-scale-model}{%
\subsubsection{Second Moment Condition: Scale
model}\label{second-moment-condition-scale-model}}

\hypertarget{references}{%
\section*{References}\label{references}}
\addcontentsline{toc}{section}{References}

\hypertarget{refs}{}
\begin{CSLReferences}{1}{0}
\leavevmode\vadjust pre{\hypertarget{ref-abowed2006}{}}%
Abowd, John M., Francis Kramarz, and Sébastien Roux. 2006. {``Wages,
Mobility and Firm Performance: Advantages and Insights from Using
Matched Worker--Firm Data*.''} \emph{The Economic Journal} 116 (512):
F245--85.
https://doi.org/\url{https://doi.org/10.1111/j.1468-0297.2006.01099.x}.

\leavevmode\vadjust pre{\hypertarget{ref-cameron2005}{}}%
Cameron, Adrian Colin, and Pravin K. Trivedi. 2005.
\emph{Microeconometrics: Methods and Applications}. Cambridge ; New
York: Cambridge University Press.

\leavevmode\vadjust pre{\hypertarget{ref-canay2011}{}}%
Canay, Ivan A. 2011. {``A Simple Approach to Quantile Regression for
Panel Data.''} \emph{The Econometrics Journal} 14 (3): 368--86.
https://doi.org/\url{https://doi.org/10.1111/j.1368-423X.2011.00349.x}.

\leavevmode\vadjust pre{\hypertarget{ref-correia_feasible_nodate}{}}%
Correia, Sergio. 2016. {``A {Feasible} {Estimator} for {Linear} {Models}
with {Multi}-{Way} {Fixed} {Effects}.''}
\url{http://scorreia.com/research/hdfe.pdf}.

\leavevmode\vadjust pre{\hypertarget{ref-frishwaugh1933}{}}%
Frisch, Ragnar, and Frederick V. Waugh. 1933. {``Partial Time
Regressions as Compared with Individual Trends.''} \emph{Econometrica} 1
(4): 387--401. \url{http://www.jstor.org/stable/1907330}.

\leavevmode\vadjust pre{\hypertarget{ref-frumentobotai2016}{}}%
Frumento, Paolo, and Matteo Bottai. 2016. {``Parametric Modeling of
Quantile Regression Coefficient Functions.''} \emph{Biometrics} 72 (1):
74--84. https://doi.org/\url{https://doi.org/10.1111/biom.12410}.

\leavevmode\vadjust pre{\hypertarget{ref-gaure2013}{}}%
Gaure, Simen. 2013. {``{OLS} with Multiple High Dimensional Category
Variables.''} \emph{Computational Statistics \& Data Analysis} 66:
8--18. https://doi.org/\url{https://doi.org/10.1016/j.csda.2013.03.024}.

\leavevmode\vadjust pre{\hypertarget{ref-harrissass2011}{}}%
Harris, Douglas N., and Tim R. Sass. 2011. {``Teacher Training, Teacher
Quality and Student Achievement.''} \emph{Journal of Public Economics}
95 (7): 798--812.
https://doi.org/\url{https://doi.org/10.1016/j.jpubeco.2010.11.009}.

\leavevmode\vadjust pre{\hypertarget{ref-he1997}{}}%
He, Xuming. 1997. {``Quantile Curves Without Crossing.''} \emph{The
American Statistician} 51 (2): 186--92.
\url{https://doi.org/10.1080/00031305.1997.10473959}.

\leavevmode\vadjust pre{\hypertarget{ref-kaplan2017}{}}%
Kaplan, David M., and Yixiao Sun. 2017. {``Smoothed Estimating Equations
for Instrumental Variables Quantile Regression.''} \emph{Econometric
Theory} 33 (1): 105--57.
\url{https://doi.org/10.1017/S0266466615000407}.

\leavevmode\vadjust pre{\hypertarget{ref-koenker2004}{}}%
Koenker, Roger. 2004. {``Quantile Regression for Longitudinal Data.''}
\emph{Journal of Multivariate Analysis} 91 (1): 74--89.
https://doi.org/\url{https://doi.org/10.1016/j.jmva.2004.05.006}.

\leavevmode\vadjust pre{\hypertarget{ref-koenkerbasset1978}{}}%
Koenker, Roger, and Gilbert Bassett. 1978. {``Regression Quantiles.''}
\emph{Econometrica} 46 (1): 33--50.
\url{http://www.jstor.org/stable/1913643}.

\leavevmode\vadjust pre{\hypertarget{ref-lancaster2000}{}}%
Lancaster, Tony. 2000. {``The Incidental Parameter Problem Since
1948.''} \emph{Journal of Econometrics} 95 (2): 391--413.
https://doi.org/\url{https://doi.org/10.1016/S0304-4076(99)00044-5}.

\leavevmode\vadjust pre{\hypertarget{ref-lovell1963}{}}%
Lovell, Michael C. 1963. {``Seasonal Adjustment of Economic Time Series
and Multiple Regression Analysis.''} \emph{Journal of the American
Statistical Association} 58 (304): 993--1010.
\url{https://doi.org/10.1080/01621459.1963.10480682}.

\leavevmode\vadjust pre{\hypertarget{ref-mss2019}{}}%
Machado, José A. F., and J. M. C. Santos Silva. 2019. {``Quantiles via
Moments.''} \emph{Journal of Econometrics} 213 (1): 145--73.
\url{https://doi.org/10.1016/j.jeconom.2019.04.009}.

\leavevmode\vadjust pre{\hypertarget{ref-melly2005}{}}%
Melly, Blaise. 2005. {``Decomposition of Differences in Distribution
Using Quantile Regression.''} \emph{Labour Economics} 12 (4): 577--90.
https://doi.org/\url{https://doi.org/10.1016/j.labeco.2005.05.006}.

\leavevmode\vadjust pre{\hypertarget{ref-newey_chapter_1994}{}}%
Newey, Whitney K., and Daniel McFadden. 1994. {``Chapter 36 {Large}
Sample Estimation and Hypothesis Testing.''} In \emph{Handbook of
{Econometrics}}, 4:2111--2245. Elsevier.
\url{https://doi.org/10.1016/S1573-4412(05)80005-4}.

\leavevmode\vadjust pre{\hypertarget{ref-neymanscott1948}{}}%
Neyman, J., and Elizabeth L. Scott. 1948. {``Consistent Estimates Based
on Partially Consistent Observations.''} \emph{Econometrica} 16 (1):
1--32. \url{http://www.jstor.org/stable/1914288}.

\leavevmode\vadjust pre{\hypertarget{ref-rios2015}{}}%
Rios-Avila, Fernando. 2015. {``Feasible {Fitting} of {Linear} {Models}
with {N} {Fixed} {Effects}.''} \emph{The Stata Journal} 15 (3): 881--98.
\url{https://doi.org/10.1177/1536867X1501500318}.

\leavevmode\vadjust pre{\hypertarget{ref-zhao2000}{}}%
Zhao, Quanshui. 2000. {``Restricted {Regression} {Quantiles}.''}
\emph{Journal of Multivariate Analysis} 72 (1): 78--99.
https://doi.org/\url{https://doi.org/10.1006/jmva.1999.1849}.

\end{CSLReferences}



\end{document}
